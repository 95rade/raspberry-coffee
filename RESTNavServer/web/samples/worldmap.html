<!DOCTYPE html>
<!--
 | Take move-fast=false as QS parameter.
 | Start the nav server (./runNavServer)
 | Then try http://localhost:9999/web/samples/worldmap.html?move-fast=false
 +-->
<html>
  <head>
    <!--meta charset="windows-1252"-->
    <!--meta charset="iso-8859-1"-->
    <!--meta charset="utf-8"-->
    <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
    <title>World Map Demo</title>

    <link rel="icon" type="image/ico" href="../icons/hammerhead.02.ico">

    <link rel="stylesheet" href="../css/stylesheet.css" type="text/css"/>
		<link rel="stylesheet" href="../css/black.css" type="text/css" id="theme"/>
    <script type="text/javascript" src="../js/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="../js/date.proto.js"></script>
		<script type="text/javascript" src="../widgets/WorldMapData.js"></script>
    <script type="text/javascript" src="../widgets/worldmap.js"></script>
    <script type="text/javascript" src="../js/pub.sub.js"></script>
    <script type="text/javascript" src="../js/conversion.utils.js"></script>
    <script type="text/javascript" src="../js/routes.utils.js"></script>
		<script type="text/javascript" src="worldmap.demo.js"></script>
    <script type="text/javascript">
    
  var DURATION_FMT = "Y-m-dTH:i:s";
  var flavor = 'Ajax'; // Default, WebSocket not implemented here (we run on a small http server).

	var astroCallback = function(data) { // Intercepted
		console.log("Astro Data:", data);
		document.getElementById("sun-data").innerHTML =
			'<table><tr><td>Sun D:</td><td align="right">' +
			decToSex(data.sun.decl, "NS") +
			'</td></tr><tr><td>Sun GHA:</td><td align="right">' +
			decToSex(data.sun.gha) +
			'</td></tr><tr><td>Moon D:</td><td align="right">' +
			decToSex(data.moon.decl, "NS") +
			'</td></tr><tr><td>Moon GHA:</td><td align="right">' +
			decToSex(data.moon.gha) +
			'</td></tr></table>';
		worldMap.setAstronomicalData(data);
	};

  window.onload = function() {
    init(); // init UI

	  worldMap.clear();
	  worldMap.setPositionLabel("");
    setTimeout(function() {
	    worldMap.drawWorldMap();
    }, 1);

	  initAjax(); // Starts the clock

    document.getElementById("console-type").innerHTML = 'The HTML5 ' + flavor + ' Console.';

    /**
		 *  SUBSCRIBERS HERE.
		 *
     * The following subscriptions make the distinction between Ajax & WebSockets
     * (See the initAjax & initWS methods)
     */
    events.subscribe('pos', function(val) {
	    worldMap.clear();
	    worldMap.drawWorldMap();
	    worldMap.setUserPosition({ latitude: val.lat, longitude: val.lng });
    });
	  events.subscribe('gps-time', function(val) {
		  // Request astronomical data for the map
		  var date = new Date(val);
		  getAstroData(date.format(DURATION_FMT), astroCallback);
	  });
  };

  var displayErr = function(err) {
    if (err !== undefined) {
	    document.getElementById("err-mess").innerHTML = ("<small>" + err + "</small>");
    }
  };

  var changeGrid = function(cb) {
  	worldMap.setWithGrid(cb.checked);
  };
  var changeSun = function(cb) {
	  worldMap.setWithSun(cb.checked);
  };
  var changeMoon = function(cb) {
	  worldMap.setWithMoon(cb.checked);
  };
  var changeSunlight = function(cb) {
	  worldMap.setWithSunLight(cb.checked);
  };
  var changeMoonlight = function(cb) {
	  worldMap.setWithMoonLight(cb.checked);
  };

  var changeLat = function(slider) {
    var val = slider.value;
    position.lat = val;
	  worldMap.setUserLatitude(parseInt(val));
  };
    </script>
  </head>
  <body>
    <h2>World Globe Demo</h2>
    <!--h4>Traveling east, random latitude increment.</h4-->
    <div style="display: none;">
      <img src="../images/moon-white.png" id="moon-png" />
      <img src="../images/sun-white.png" id="sun-png" />
    </div>
    <table border="0">
      <tr>
        <td valign="top" rowspan="2">
          <div id="map" style="display: block; height: 450px; width: 850px;">
            <p align="center">
              <canvas id="mapCanvas" width="800" height="400" style="border-radius:10px;"></canvas>
            </p>
          </div>
        </td>
        <td valign="top">
          <div id="current-date"> --- </div>
          <input type="checkbox" onchange="changeGrid(this);" checked/> With Grid
          <br/>
          <input type="checkbox" onchange="changeSun(this);" checked/> With Sun
          <br/>
          <input type="checkbox" onchange="changeMoon(this);" checked/> With Moon
          <br/>
          <input type="checkbox" onchange="changeSunlight(this);" /> With Sun light
          <br/>
          <input type="checkbox" onchange="changeMoonlight(this);" /> With Moon light
          <br />
          Latitude:
          <br />
          <input type="range" min="-90" max="90" step="1" value="38" title="Latitude" onchange="changeLat(this);"/>
        </td>
      </tr>
	    <tr>
		    <td valign="bottom">
			    <i>Sun and Moon</i>
			    <br />
			    <div id="sun-data"></div>
			    <br/>
			    <div id="moon-data"></div>
		    </td>
	    </tr>
      <tr>
        <td colspan="2">
          <div id="err-mess"></div>
        </td>
      </tr>
    </table>
    <address><span id="console-type"></span></address>
  </body>
</html>
  