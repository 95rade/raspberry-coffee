package nmea.forwarders.rmi.clientoperations;

import com.google.gson.Gson;
import context.ApplicationContext;
import context.NMEADataCache;
import nmea.forwarders.rmi.Task;

import java.io.Serializable;

/**
 * Task invokable by the client.
 * Runs (executes) on the server.
 *
 * Get ALL the cache
 * This one could be used to implement a full console.
 */
public class NMEACache implements Task<NMEADataCache>, Serializable {

	private static final long serialVersionUID = 227L;

	public NMEACache() {
	}

	public NMEADataCache execute() {
		NMEADataCache cache = ApplicationContext.getInstance().getDataCache();
		/*
		{"Damping":30,"HDG Offset":0.0,"D":{"angle":10.0},"XTE":{"distance":3.0},"To Waypoint":"RANGI   ","AWA":{"angle":-127.0},"Depth":{"depthInMeters":1.7000000476837158},"CDR":{"angle":153.20401371546302},"Daily":{"distance":12.4},"Bearing to WP":{"angle":230.0},"Max Leeway":10.0,"W":{"angle":9.01692220976113},"Speed to WP":{"speed":6.9},"COG":{"angle":220.0},"HDG c.":{"angle":226.0},"CMG":{"angle":235.01692220976113},"AWS":{"speed":15.6},"HDG true":{"angle":235.01692220976113},"BSP":{"speed":6.5},"AWA Offset":0.0,"TWA":{"angle":-146.6086335818184},"TWD":{"angle":88.0},"Current calculated with damping":{"600000":{"bufferLength":600000,"speed":{"speed":0.3823256500119228},"direction":{"angle":161.74895190013757}}},"CSP":{"speed":1.832405479531865},"d":{"angle":-0.9830777902388692},"Position":{"lat":-9.110283333333333,"lng":-140.21116666666666},"Log":{"distance":3013.0},"Solar Time":{"date":"Jan 1, 1970 4:48:19 AM"},"Default Declination":{"angle":14.0},"Deviation file name":"dp_2011_04_15.csv","HDG mag.":{"angle":225.01692220976113},"SOG":{"speed":7.0},"Leeway":{"angle":0.0},"GPS Date \u0026 Time":{"date":"Nov 21, 2010 2:09:08 PM"},"BSP Factor":1.0,"WayPoint pos":{"lat":0.0,"lng":0.0},"Set and Drift":{"speed":0.4,"angle":162},"From Waypoint":"","TWS":{"speed":19.3},"GPS Time":{"date":"Jan 1, 1970 2:09:10 PM"},"Steer":"R","Distance to WP":{"distance":561.6},"AWS Factor":1.0,"Water Temperature":{"temperature":26.5},"Deviation data":[[0.0,-0.9830777902388692],[5.0,-0.011026572256005562],[10.0,0.9376226337606713],[15.0,1.8481417760529473],[20.0,2.706968419259063],[25.0,3.502010498068172],[30.0,4.222907157619058],[35.0,4.861238566208396],[40.0,5.41067912434326],[45.0,5.867090195983481],[50.0,6.228550301400268],[55.0,6.495322581506744],[60.0,6.669761214187589],[65.0,6.756160277498707],[70.0,6.7605502578040655],[75.0,6.690448941561685],[80.0,6.554574761133859],[85.0,6.362531747629985],[90.0,6.124476044941308],[95.0,5.8507744349216315],[100.0,5.551665499532208],[105.0,5.236933896868645],[110.0,4.915607759369771],[115.0,4.595688448946321],[120.0,4.283920849305126],[125.0,3.9856110729647214],[130.0,3.704496949485935],[135.0,3.442674988721282],[140.0,3.2005857297696667],[145.0,2.977057547498281],[150.0,2.7694071503264177],[155.0,2.573593221779761],[160.0,2.3844179886852896],[165.0,2.1957699919350953],[170.0,2.0009000376758603],[175.0,1.7927212573719298],[180.0,1.564123436643458],[185.0,1.3082913087229513],[190.0,1.0190163631360891],[195.0,0.6909918983974049],[200.0,0.32008154384771514],[205.0,-0.09644772473539881],[210.0,-0.5597359726927196],[215.0,-1.0691906695510365],[220.0,-1.622402069488621],[225.0,-2.215116961345255],[230.0,-2.84127234278794],[235.0,-3.493088722710017],[240.0,-4.161220908864994],[245.0,-4.834962350507458],[250.0,-5.502497433045342],[255.0,-6.1511946145729715],[260.0,-6.76793199882747],[265.0,-7.339445895365194],[270.0,-7.852692157744217],[275.0,-8.295209637786897],[280.0,-8.65547496282729],[285.0,-8.923238037717315],[290.0,-9.089828188874868],[295.0,-9.148421688677415],[300.0,-9.094262500629787],[305.0,-8.9248294360204],[310.0,-8.639944470738897],[315.0,-8.24181868975783],[320.0,-7.735034154780319],[325.0,-7.126461872693328],[330.0,-6.425117922047334],[335.0,-5.641961615169332],[340.0,-4.7896412798423365],[345.0,-3.8821947853221292],[350.0,-2.9347132663805713],[355.0,-1.9629775760350432],[360.0,-0.9830777902388721]],"NMEA":"$IIMTW,+26.5,C*39\n\r"}
		 */
		String content = new Gson().toJson(cache).toString(); // For tests
		System.out.println(content);
		return cache;
	}
}
