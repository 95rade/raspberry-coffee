<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
    <title>NMEA Weather Station Console</title>

    <link rel="icon" type="image/ico" href="icons/hammerhead.02.ico">

    <link rel="stylesheet" href="css/stylesheet.css" type="text/css"/>

    <script type="text/javascript" src="js/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="js/pub.sub.js"></script>
    <script type="text/javascript" src="js/ajax.manager.js"></script>

		<link rel="stylesheet" href="css/web-components.css">

		<!-- Firefox does NOT like modules... Safari OK -->
		<script type="module" src="webcomponents/Pluviometer.js"></script>
		<script type="module" src="webcomponents/Thermometer.js"></script>
		<script type="module" src="webcomponents/DirectionDisplay.js"></script>
		<script type="module" src="webcomponents/AnalogDisplay.js"></script>

		<script type="text/javascript">

	var status = 'tick';

  window.onload = function() {
    initAjax(false);
    // Subscribers here
    events.subscribe('at', function(val) {
    	if (status === 'tick') {
    		status = 'tock';
    		document.getElementById('working').style.color = 'red';
			} else {
		    status = 'tick';
		    document.getElementById('working').style.color = 'green';
			}
      console.log("Air Temperature : %f", val);
	    setData(val, 'thermometer-01');
    });
	  events.subscribe('dew', function(val) {
		  console.log("Dew Point Temperature : %f", val);
		  setData(val, 'thermometer-02');
	  });
    events.subscribe('prmsl', function(val) {
      console.log("Atm Pressure : %f", val);
	    setData(val, 'prmsl-01');
    });
    events.subscribe('hum', function(val) {
	    console.log("Relative Humidity : %f", val);
	    setData(val, 'hum-01');
    });
    events.subscribe('tws', function(val) {
	    console.log("Wind Speed : %f", val);
	    setData(val, 'tws-01');
    });
    events.subscribe('twd', function(val) {
	    console.log("Wind Direction : %f", val);
	    setData(val, 'twd-01');
    });
	  events.subscribe('prate', function(val) {
		  console.log("Precipitation Rate : %f", val);
		  setData(val, 'rain-01');
	  });
  };

  var displayErr = function(err) {
    if (err !== undefined)
      document.getElementById("err-mess").innerHTML = ("<small>" + err + "</small>");
  };

  window.onresize = function() {
//  console.log("Re-evaluating window size");
    resizeComponents();
  };

  var resizeComponents = function() {
    var ww = window.innerWidth;
    var wh = window.innerHeight;

  };

  /**
   * Set data to the WebComponents
   * Assume that they all have a 'value' member.
   *
   * @param from The field containing the value to set
   * @param to The WebComponent to set the value to
   */
  function setData(val, to) {
	  let elem = document.getElementById(to);
		elem.value = val;                            // value corresponds to the 'set value(val) { ...', invokes the setter in the HTMLElement class
  }

  function setElementBorder(display, border) {
	  display.withBorder = border;
	  display.repaint();
	}

  function setBorder(border) {
		let displays = document.getElementsByTagName('analog-display');
		for (let i=0; i<displays.length; i++) { // forEach does not work?
			setElementBorder(displays[i], border);
		}
	  displays = document.getElementsByTagName('direction-display');
	  for (let i=0; i<displays.length; i++) { // forEach does not work?
		  setElementBorder(displays[i], border);
	  }
	}

	function setElementStyle(widget, style) {
		widget.className = style;
		widget.repaint();
	}

	function setElementsStyle(
			analogStyle,
			directionStyle,
			tempStyle,
			rainStyle) {
		let displays = document.getElementsByTagName('analog-display');
		for (let i=0; i<displays.length; i++) {
			setElementStyle(displays[i], analogStyle);
		}
		displays = document.getElementsByTagName('direction-display');
		for (let i=0; i<displays.length; i++) {
			setElementStyle(displays[i], directionStyle);
		}
		displays = document.getElementsByTagName('thermo-meter');
		for (let i=0; i<displays.length; i++) {
			setElementStyle(displays[i], tempStyle);
		}
		displays = document.getElementsByTagName('pluvio-meter');
		for (let i=0; i<displays.length; i++) {
			setElementStyle(displays[i], rainStyle);
		}
	}

	function setStyle(style) {
		console.log("Style:" + style);
		switch (style) {
			case 'orange':
				setElementsStyle(
						'analogdisplay-monochrome-orange',
						'analogdisplay-monochrome-orange',
						'thermometer-orange',
						'pluviometer-orange');
				break;
			case 'cyan':
				setElementsStyle(
						'analogdisplay-monochrome-cyan',
						'analogdisplay-monochrome-cyan',
						'thermometer-cyan',
						'pluviometer-cyan');
				break;
			case 'day':
				setElementsStyle(
						'analogdisplay-day',
						'analogdisplay-day',
						'thermometer-day',
						'pluviometer-day');
				break;
			case 'night':
				setElementsStyle(
						'analogdisplay-night',
						'analogdisplay-night',
						'thermometer-night',
						'pluviometer-night');
				break;
			case 'flat-gray':
				setElementsStyle(
						'analogdisplay-flat-gray',
						'analogdisplay-flat-gray',
						'thermometer-day',
						'pluviometer-day');
				break;
			case 'flat-black':
				setElementsStyle(
						'analogdisplay-flat-black',
						'analogdisplay-flat-black',
						'thermometer-night',
						'pluviometer-night');
				break;
			default:
				break;
		}
	}
		</script>
		<style>
			html {
				height: 100%;
				background-color: black;
			}

			body {
				background-color: black;
				color: silver;
				font-family: "Helvetica Neue", Verdana, Arial, Helvetica, sans-serif;
				/* background-image: linear-gradient(to bottom right, #4d4d4d, black); */
				background: radial-gradient(at top, DarkGrey -8%, black 55%);
				background-repeat: no-repeat;
				background-size: 100% 100%;
			}

		</style>

  </head>
  <body>
		<table>
			<tr>
				<td align="left">
					<table>
						<tr>
							<td><h3>Web Components UI&nbsp;&nbsp;&nbsp;</h3></td>
							<td>
								<!-- Traffic witness -->
								<span id="working" title="Traffic">&#11044;</span>
							</td>
							<td>
								<!-- Display Style -->
								Style:
								<select onchange="setStyle(this.value);">
									<option value="orange" selected>Orange</option>
									<option value="cyan">Cyan</option>
									<option value="day">Day</option>
									<option value="night">Night</option>
									<option value="flat-gray">Flat gray</option>
									<option value="flat-black">Flat black</option>
								</select>
								<!-- Display Border -->
								<input type="checkbox" checked onchange="setBorder(this.checked);"/>Border
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">
					<table>
						<tr>
							<td align="center">
								<!-- True Wind Speed in knots<br/ -->
								<analog-display class="analogdisplay-monochrome-orange"
																title="True Wind Speed in knots"
																id="tws-01"
																min-value="0"
																max-value="60"
																value="0"
																major-ticks="10"
																minor-ticks="1"
																with-border="true"
																overlap="40"
																label="TWS"
																width="200"
																height="200"></analog-display>
							</td>
							<td align="center">
								<!-- Wind Direction in &deg;<br/ -->
								<direction-display class="analogdisplay-monochrome-orange"
																	 title="TWD"
																	 id="twd-01"
																	 value="0"
																	 major-ticks="45"
																	 minor-ticks="5"
																	 with-rose="true"
																	 with-border="true"
																	 label="TWD"
																	 width="200"
																	 height="200"></direction-display>

							</td>
							<td align="center">
								<!-- Air Temperature in &deg;C<br/ -->
								<thermo-meter id="thermometer-01"
															class="thermometer-orange"
															title="Air, Celcius"
															min-value="-10"
															max-value="60"
															major-ticks="10"
															minor-ticks="1"
															value="0"
															width="100"
															height="220"></thermo-meter>
							</td>
							<td align="center">
								<!-- Dew point Temperature in &deg;C<br/ -->
								<thermo-meter id="thermometer-02"
															class="thermometer-orange"
															title="Dew point, Celcius"
															min-value="-10"
															max-value="60"
															major-ticks="10"
															minor-ticks="1"
															value="0"
															width="100"
															height="220"></thermo-meter>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">
					<table>
						<tr>
							<td align="center">
								<!-- Atm Pressure in hPa<br/ -->
								<analog-display class="analogdisplay-monochrome-orange analog-for-prmsl"
																title="Pressure in hPa"
																id="prmsl-01"
																min-value="983"
																max-value="1043"
																value="1013.6"
																major-ticks="10"
																minor-ticks="1"
																with-border="true"
																overlap="40"
																label="PRMSL"
																width="200"
																height="200"></analog-display>
							</td>
							<td align="center">
								<!-- Relative Humidity in %<br/ -->
								<analog-display class="analogdisplay-monochrome-orange"
																title="Humidity in %"
																id="hum-01"
																min-value="0"
																max-value="100"
																value="50"
																major-ticks="10"
																minor-ticks="1"
																with-border="true"
																overlap="40"
																label="HUM"
																width="200"
																height="200"></analog-display>
							</td>
							<td align="center">
								<!-- Precipitation Rate in mm/h<br/ -->
								<pluvio-meter id="rain-01"
															class="pluviometer-orange"
															title="m/m per hour"
															min-value="0"
															max-value="10"
															major-ticks="1"
															minor-ticks="0.25"
															value="0"
															width="80"
															height="220"></pluvio-meter>
							</td>
						</tr>
					</table>
				</td>
			</tr>
		</table>

    <div id="err-mess"></div>
		<hr/>
    <address>Oliv did it</address>
  </body>
</html>
