<!DOCTYPE html>
<html>
  <head>
    <title>Log my Run</title>
    <meta charset="utf-8">
    <link rel="icon" type="image/jpg" href="icons/palm.04.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/jquery.mobile-1.3.2.min.css" />
    <script src="js/jquery-2.1.3.js"></script>
    <script src="./js/jquery.mobile-1.3.2.min.js"></script>
    <script type="text/javascript" src="js/restskill.js"></script>
    <script type="text/javascript">

  var logEnabled = function(cb) {
    if ("on" === cb.value) {
      console.log('On');
      enableLogging(true)
    } else {
      console.log('Off');
      enableLogging(false)
    }
  };

  var speedUnit = function(su) {
    if (su.value !== undefined && su.value.trim().length > 0) {
      setSpeedUnit(su.value);
    }
  };

  var forwarderStatus = function() {
    var getData = getForwarderStatus(); // A promise
    getData.done(function(value) {
        var json = JSON.parse(value); // Like {"processing":false,"started":1501082121336}
        var status = json.processing;
        $("#flip-1").val(status === true ? 'on' : 'off').slider('refresh'); // important: slider.refresh
    });
    getData.fail(function(error, errmess) {
        var message;
        if (errmess !== undefined) {
            if (errmess.message !== undefined) {
                message = errmess.message;
            } else {
                message = errmess;
            }
        }
        console.log("Failed to get the forwarders status..." + (error !== undefined ? error : ' - ') + ', ' + (message !== undefined ? message : ' - '));
    });
  };

    </script>
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>Running!..</h1>
      </div>

      <div data-role="content">

        <label for="flip-1">Logging:</label>
        <select name="flip-1" id="flip-1" data-role="slider" onchange="logEnabled(this);">
        	<option value="off">Off</option>
        	<option value="on">On</option>
        </select>

        <label for="speed-unit">Set Speed Unit:</label>
        <select name="speed-unit" id="speed-unit" onchange="speedUnit(this);">
          <option value=""></option>
          <option value="kmh">km/h</option>
          <option value="mph">mph</option>
          <option value="ms">m/s</option>
          <option value="kts">knots</option>
        </select>

        <div class="ui-body ui-body-b">
          <fieldset class="ui-grid-a">
            <div class="ui-block-b"><button data-theme="a" id="b-terminate">Terminate</button></div>
          </fieldset>
        </div>
      </div>
      <div style="display: none"> <!-- turn display to block or inline for debugging -->
        <textarea id="message" style="width: 98%; height: 150px;"></textarea>
      </div>
    </div>
    <script>
      var appendMess = function(txt) {
        var content = $('#message').text();
        content += ((content.length > 0 ? '\n' : '') + txt);
        $('#message').text(content);
      };

      $().ready(function() {

        forwarderStatus();

        $("#b-terminate").click(function() {
          console.log("terminating");
          terminate();
          $("#b-terminate").prop('disabled', true);
          // Say bye-bye...
          document.body.innerHTML =
          '<h1 style="color: blue; font-family: Verdana, Helvetica, Geneva;">Bye-bye...</h1>' +
          '<h2 style="color: blue; font-family: Verdana, Helvetica, Geneva;">Server is going down upon your request.</h2>' +
          '<p style="color: blue; font-family: Verdana, Helvetica, Geneva;">Restart the server from a terminal to continue...</p>';
        });
      });
    </script>
  </body>
</html>
