<!DOCTYPE html>
<html>
<head>
	<title>Ocean Beach Tide</title>
	<link rel="icon" type="image/jpg" href="icons/palm.04.jpg">
	<!--meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /-->
	<link id="page-ux" rel="stylesheet" href="css/stylesheet.css" type="text/css"/>
	<script type="text/javascript" src="js/jquery-2.1.3.js"></script>
	<script type="text/javascript" src="js/date.proto.js"></script>
	<script type="text/javascript" src="js/tide.js"></script>
	<script type="text/javascript" src="js/pub.sub.js"></script>
	<script type="text/javascript" src="widgets/Graph.js"></script>
	<script type="text/javascript">
		var tideGraph; // The graph itself.
		var tideData = [];
		var graphCallback = undefined;
		window.onload = function() {

			tideGraph = new Graph("tideCanvas", tideData, graphCallback, "feet");
		};

		var dataManager = function(value) { // Callback when tide data are ready
//		console.log(value);
			try {
				var json = JSON.parse(value);
				var base = json.baseHeight;
				var data = json.heights;
				// Detect min & max
				var min = base, max = base;
				var size = 0;
				tideData = [];
				for (var tDate in data){
					tideData.push(new Tuple(size, data[tDate]));
					size++;
//				console.log(tDate + ': ' + data[tDate]);
					min = Math.min(min, data[tDate]);
					max = Math.max(max, data[tDate]);
				}
				console.log("Base: " + base);
				console.log(size + " element(s)");
				console.log("Min: " + min + ", Max: " + max);

				tideGraph.drawGraph("tideCanvas", tideData); //, idx2plot);
			} catch (err) {
				console.log(err);
			}
		};

	</script>
</head>
<body>
  <h2>Tide Curve tests</h2>
	<hr/>
  Tide at Ocean Beach, today.
	<hr/>
	<!-- Graph here -->
	<div style="width: 100%;">
		<canvas id="tideCanvas" style="height: 400px; width: 100%;" title="Tide Curve"></canvas>
	</div>

	<hr/>
	<button onclick="tideTable('Ocean Beach, California', '', '', '', dataManager);">Draw Curve</button>
	<hr/>
	Results:
	<br/>
	<div id="result" style="font-family: 'Source Code Pro', 'Courier New', Helvetica, Geneva; display: block; padding: 1px; border-radius: 5px; border: 1px solid #CCC; min-height: 200px; max-height: 200px; overflow-y: scroll;"></div>
  <hr/>
	Errors:
  <br/>
	<div id="error" style="font-family: 'Source Code Pro', 'Courier New', Helvetica, Geneva; color: red; display: block; padding: 1px; border-radius: 5px; border: 1px solid #CCC; min-height: 75px; max-height: 75px; overflow-y: scroll;"></div>
	<button onclick="$('#error').html('');">Clear log</button>
	<hr/>
	Messages:
	<br/>
	<div id="messages" style="font-family: 'Source Code Pro', 'Courier New', Helvetica, Geneva; display: block; padding: 1px; border-radius: 5px; border: 1px solid #CCC; min-height: 50px; max-height: 50px; overflow-y: scroll;"></div>
	<button onclick="$('#messages').html('');">Clear log</button>
	<hr/>
</body>
</html>